<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<meta charset="UTF-8"/>
<div id="layoutSidenav_content">
	<main>
		<div class="container-fluid px-4">

			<div class="row mt-3 mb-5">
				<div class="articleList">
					<div class="articleVO-header">
						<i class="board-name" th:text="${boardName}">게시판 이름</i>
					</div>
					<div class="articleVOS card-body">
						<input type="hidden" id="boardNo" th:value="${boardNo}">

						<div class="dataTable-top"></div>
						<div class="dataTable-container">
							<table class="dataTable-table">
								<thead>
									<tr>
										<th>No</th>
										<th>제목</th>
										<th>작성자</th>
										<th>작성일</th>
										<th>조회수</th>
										<th>추천</th>
									</tr>
								</thead>

								<tbody id="article_list" >
								<div th:if ="${articles == null}">
									<tr>
										<td rowspan="6">등록된 게시글이 없습니다.</td>
									</tr>
								</div>
								<div th:unless ="${articles == null}">
									<tr th:each="article : ${articles}">
										<td th:text="${article.no}"></td>
										<td>
											<a th:text="${article.subject}"
												th:href="|/articles/${article.no}|"></a>
										</td>
										<td >
										<a th:id = "${article.memberNo}" onclick=openNote(this) th:text="${article.nickname}"></a>
										</td>
										<td th:text="${article.writeDate}"></td>
										<td th:text="${article.viewcount}"></td>
										<td th:text="${article.likecount}"></td>
									</tr>
								</div>
								</tbody>
							</table>
						</div>
						<div class="dataTable-bottom"></div>
					</div>
					<div class="write_article_btn">
						<!-- <button id="writeForm_btn" th:onclick="|location.href='@{/articles/insert}'|" -->
							<button id="writeForm_btn" onclick="writeForm()"
							type="button">글쓰기</button>
					</div>
					<div id="search_area">
<!--						<form id="search_form" action="/board/search" method="get">-->
							<select id="keyword" name="keyword">
								<option value="subject">제목</option>
								<option value="nickname">작성자</option>
								<option value="tagname">태그</option>
							</select>
							<input type="text" id="search_content" name="content" placeholder="검색어를 입력해 주세요.">
							<input type="button" id="search_by_board_btn" value="검색">
<!--						</form>-->
					</div>
				</div>
			</div>
		</div>
	</main>
</div>
<script th:src="@{/js/jquery-3.6.0.min.js}"></script>
<script>

	$('#search_by_board_btn').on('click', function (){
		const keyword = $('#keyword').val();
		const content = $('#search_content').val();
		const boardNo = $('#boardNo').val();
		console.log('boardNo', boardNo);
		console.log('keyword', keyword);
		console.log('content',content);
		$.ajax({
			url: '/board/search',
			method: 'GET',
			dataType: 'json',
			data: {
				boardNo: boardNo,
				keyword: keyword,
				content: content
			},
			success: function (data) {
				results = data;
				htmlStr = "";
				$('#article_list').html(""); //view창 비우기
				for (let i = 0; i < results.length; i++) {
					htmlStr += "<tr>";
					htmlStr += "<td>" + results[i].no + "</td>";
					htmlStr += "<td>";
					htmlStr += "<a href='/articles/"+results[i].no + "'>" + results[i].subject + "</a>";
					htmlStr += "</td>";
					htmlStr += "<td>";
					htmlStr += "<a id = " + results[i].memberNo + " onclick=openNote(this)>" + results[i].nickname + "</a>";
					htmlStr += "</td>";
					htmlStr += "<td>" + results[i].writeDate + "</td>";
					htmlStr += "<td>" + results[i].viewcount + "</td>";
					htmlStr += "<td>" + results[i].likecount + "</td>";
					htmlStr += "</tr>";
				}
				console.log(htmlStr);
				$('#article_list').html(htmlStr);
			},
			error: function (e) {
				console.trace();
				reject(e);
			}
		});

	});
	article_list





	function writeForm(){
		location.href="/articles/insert";
	}
/* 	function openNote(e) {
			const memberNo = e.id;
			console.log(1, memberNo);
			window.open('writenote?memberNo=' + memberNo, '쪽지작성창', 'width=500px', 'height=500px');
	} */
</script>
</html>