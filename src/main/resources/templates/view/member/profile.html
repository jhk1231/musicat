<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://thymeleaf.org">

<body>
<div id="modal-profile" class="modal fade" role="dialog" th:fragment="modalContents">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
            </div>
            <div class="modal-body">
                <form method="POST" enctype="multipart/form-data" th:action="@{'/profile/' + ${profile.no}}">
                    <table>
                        <tr class="first">
                            <td id="preview_image">미리보기</br>타입 : .gif, .jpg, .png</br>크기 : 3MB이하</td>
                            <td><img id="im" th:src="|/profileTempImage/${profile.getSystemFileName()}|" alt=""
                                     style="width: 200; height: 200;"></td>
                        </tr>
                        <tr class="second">
                            <td>
                                <button type="button" id="resetBtn" onclick="resetImage()">기본 이미지</button>
                            </td>
                            <td><input type="file" id="chooseFile" name="importAttachFile"
                                       accept="image/gif, image/jpg, image/png"></td>
                        </tr>
                    </table>
                    <input type="hidden" id="flag" name="resetFlag" value="false">
                    <div></div>
                    <input type="textarea" name="bio" th:value="${profile.bio}">
                    <div></div>
                    <button type="submit" id="updateBtn" onclick="alert('수정완료')">수정</button>
                </form>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>
</body>
<script th:src="@{/js/jquery-3.6.0.min.js}"></script>
<script>

    function endProfile() {
        alert('수정완료');
        setTimeout(function(){
            location.reload();
        },3000);
    }

    let flag = document.getElementById("flag");
    $(function () {
        $('#chooseFile').on('change', function () {
            changeFile(this);
        });
    });

    function changeFile(f) {
        if (f.files && f.files[0]) {
            var reader = new FileReader();
            var ext = String(f.files[0].type).toLowerCase();
            console.log(ext);
            var size = f.files[0].size;
            if ($.inArray(ext, ['image/png', 'image/jpg', 'image/gif']) == -1) {
                alert(ext + ' 파일은 업로드 할 수 없습니다.');
                $("#chooseFile").val("");
                return false;
            }
            if (size > 3 * 1024 * 1024) {
                alert('3MB 이하의 파일 크기여야 합니다.');
                $("#chooseFile").val("");
                return false;
            }
            reader.onload = function (e) {
                $("#im").attr('src', e.target.result);
            }
            reader.readAsDataURL(f.files[0]);
        }
        flag.vlaue = "false";
    }

    function resetImage() {
        $("#im").attr('src', "/profileTempImage/Seoul.JPG");
        $("#chooseFile").val("");
        flag.value = "true";
    }
</script>
